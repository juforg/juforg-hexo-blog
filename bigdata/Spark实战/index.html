<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">










  <meta name="google-site-verification" content="jMHRiBfNOcZpLeHK0bJ1AaYU5A1z-0QXMbVc4yXgNfM">

















  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.2/css/font-awesome.min.css">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/appcityico.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/appcityico.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'ZZE0EYQZDX',
      apiKey: 'f906b8260884e9894c6e3bc49c54ffe0',
      indexName: 'hexoblog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"输入关键字","hits_empty":"没找到关于: ${query} 的内容","hits_stats":"找到 ${hits} 个陪陪结果 ，用时${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="What ? Apache Spark 一站式处理方案  sql 离线计算 实时流 机器学习 图计算  &amp;lt;!-- more --&amp;gt;   One stack rule them all  stream processiong 流式计算 ad hoc queries 热查询 batch processing 批处理     spark的shuffle 当超过一定量之后也会 落地到磁盘 产生">
<meta name="keywords" content="大数据,Spark">
<meta property="og:type" content="article">
<meta property="og:title" content="Spark实战">
<meta property="og:url" content="http://blog.appcity.vip/bigdata/Spark实战/index.html">
<meta property="og:site_name" content="夕拾阁">
<meta property="og:description" content="What ? Apache Spark 一站式处理方案  sql 离线计算 实时流 机器学习 图计算  &amp;lt;!-- more --&amp;gt;   One stack rule them all  stream processiong 流式计算 ad hoc queries 热查询 batch processing 批处理     spark的shuffle 当超过一定量之后也会 落地到磁盘 产生">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/13/1544672671942.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/13/1544671204288.png">
<meta property="og:image" content="http://oapwg4v13.bkt.clouddn.com/1478314730.png">
<meta property="og:image" content="http://oapwg4v13.bkt.clouddn.com/1478314944.png">
<meta property="og:image" content="http://oapwg4v13.bkt.clouddn.com/1478336727.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/13/1544689009773.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545018690371.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545208035223.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545212118571.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545212666715.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545027799174.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545028681553.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545215215942.png">
<meta property="og:image" content="http://oapwg4v13.bkt.clouddn.com/1478337300.png">
<meta property="og:image" content="http://oapwg4v13.bkt.clouddn.com/1478337459.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545204757260.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544883984019.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544878999482.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544879233618.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544879676963.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544879847739.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/14/1544798440810.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/14/1544798567313.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544882112830.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/14/1544775013044.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544882432055.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545013001423.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545013938695.png">
<meta property="og:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545053765403.png">
<meta property="og:updated_time" content="2020-02-05T14:47:18.912Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spark实战">
<meta name="twitter:description" content="What ? Apache Spark 一站式处理方案  sql 离线计算 实时流 机器学习 图计算  &amp;lt;!-- more --&amp;gt;   One stack rule them all  stream processiong 流式计算 ad hoc queries 热查询 batch processing 批处理     spark的shuffle 当超过一定量之后也会 落地到磁盘 产生">
<meta name="twitter:image" content="http://wntc-1251220317.cossh.myqcloud.com/2018/12/13/1544672671942.png">



  <link rel="alternate" href="/atom.xml" title="夕拾阁" type="application/atom+xml">




  <link rel="canonical" href="http://blog.appcity.vip/bigdata/Spark实战/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Spark实战 | 夕拾阁</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=[object Object]"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-81118574-1');
    }
  </script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?63b060abb589ae3a3649732e9aaa9c59";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">夕拾阁</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">努力程度决定了你能达到的下限</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">24</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">55</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-doubanbooks">

    
    
    
      
    

    
      
    

    <a href="/books" rel="section"><i class="menu-item-icon fa fa-fw fa-list-ul"></i> <br>书单</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-knowledgegraph">

    
    
    
      
    

    
      
    

    <a href="/categories/mindmap/" rel="section"><i class="menu-item-icon fa fa-fw fa-joomla"></i> <br>知识图谱</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.appcity.vip/bigdata/Spark实战/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Juforg">
      <meta itemprop="description" content="以大多数人的努力程度之低还轮不到拼天赋">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="夕拾阁">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Spark实战

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-11-05 09:26:11" itemprop="dateCreated datePublished" datetime="2016-11-05T09:26:11+08:00">2016-11-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-02-05 22:47:18" itemprop="dateModified" datetime="2020-02-05T22:47:18+08:00">2020-02-05</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/bigdata/Spark实战/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/bigdata/Spark实战/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2>What ?</h2>
<p>Apache Spark
一站式处理方案</p>
<ul>
<li>sql</li>
<li>离线计算</li>
<li>实时流</li>
<li>机器学习</li>
<li>图计算</li>
</ul>
<p>&lt;!-- more --&gt;</p>
<ul>
<li>
<p>One stack rule them all</p>
<ul>
<li>stream processiong 流式计算</li>
<li>ad hoc queries 热查询</li>
<li>batch processing 批处理
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/13/1544672671942.png" alt=""></li>
</ul>
</li>
<li>
<p>spark的shuffle 当超过一定量之后也会 落地到磁盘 产生 disk io</p>
</li>
<li>
<p>4种运行模式</p>
<ul>
<li>local  eclipse中用</li>
<li>standalone 自己的集群
<ul>
<li>client</li>
<li>cluster</li>
</ul>
</li>
<li>mesos</li>
<li>yarn
<ul>
<li>client</li>
<li>cluster</li>
</ul>
</li>
</ul>
</li>
<li>
<p>RDD是基础</p>
<ul>
<li>
<p>resilient distributed dataset</p>
</li>
<li>
<p>弹性分布式数据集</p>
</li>
<li>
<p>五大特性</p>
<ul>
<li>a list of partitions <code>RDD是由一系列的partition组成的。</code></li>
<li>a function for computing each split<code>函数是作用在每一个partition(split)上的。</code></li>
<li>list of dependencies on othre RDDs<code>RDD之间有一系列的依赖关系。</code></li>
<li>optionally, a partitioner for key-value RDDs<code>分区器是作用在K,V格式的RDD上。</code></li>
<li>optionally, a list of preferred locations to compute each split on<code>RDD提供一系列最佳的计算位置。</code></li>
</ul>
<p><img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/13/1544671204288.png" alt=""></p>
</li>
</ul>
</li>
<li>
<p>主从</p>
<ul>
<li>mapreduce: RM NM</li>
<li>HDFS : NN DM</li>
<li>JOB TASK</li>
<li>spark ：master worker</li>
</ul>
</li>
</ul>
<p><img src="http://oapwg4v13.bkt.clouddn.com/1478314730.png" alt="">
<img src="http://oapwg4v13.bkt.clouddn.com/1478314944.png" alt=""></p>
<h3>容错</h3>
<ul>
<li>重算  根据 lineage</li>
<li>persist() 持久化</li>
<li>checkpoint  存磁盘</li>
</ul>
<h3>依赖</h3>
<ul>
<li>窄依赖 narrow
<ul>
<li>当个rdd转变为一个rdd 不实时处理 lazy 处理 等</li>
<li>map</li>
<li>union</li>
</ul>
</li>
<li>宽依赖 wide
<ul>
<li>groupby</li>
<li>join</li>
</ul>
</li>
</ul>
<h3>术语</h3>
<ul>
<li>
<p>application --&gt; jobs --&gt; stages--&gt; tasks</p>
</li>
<li>
<p>cluster--&gt;WNs --&gt; exeactors --&gt;threads</p>
</li>
<li>
<p>cluster manager 在集群上获取资源的外部服务 （standalone,Mesos,Yarn)</p>
</li>
</ul>
<p><img src="http://oapwg4v13.bkt.clouddn.com/1478336727.png" alt=""></p>
<pre><code>master
	standalone管理资源的主节点
cluster manager
	在集群上获取外部资源的服务
worker node
	standalone  运行于从节点，管理从节点资源
application
	基于spark的程序，包含了driver和executor
worker
	executor
		默认分配内存1G
dirver
	Driver 负责应用程序资源的申请
	任务的分发。
	连接worker
executor
	worker节点为application启动的一个进程
	负责执行任务，
	每个application都有独立的executor
task
	被送到executor上的工作单元
job
	task 的并行计算，相当于action
stage
	job被拆分后的单元
pipline
</code></pre>
<h4>算子</h4>
<ul>
<li>
<p>transfomation</p>
<ul>
<li>repartition</li>
<li>coalsce</li>
</ul>
</li>
<li>
<p>action</p>
<ul>
<li>reduce
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/13/1544689009773.png" alt=""></li>
</ul>
</li>
</ul>
<h3>shuffle</h3>
<ol>
<li>HashShuffle</li>
</ol>
<ul>
<li>普通机制
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545018690371.png" alt=""></li>
</ul>
<ol>
<li>每一个maptask将不同结果写到不同的buffer中，每个
buffer 的大小为 32K。buffer 起到数据缓存的作用。</li>
<li>每个buffer文件最后对应一个磁盘小文件。</li>
<li>reduce task 来拉取对应的磁盘小文件。</li>
</ol>
<blockquote>
<p>产生的磁盘小文件的个数: M(map task 的个数)*R(reduce task 的个数)</p>
</blockquote>
<ul>
<li>合并机制
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545208035223.png" alt=""></li>
</ul>
<ol start="2">
<li>SortShuffle 磁盘文件个数 ： 2 * M</li>
</ol>
<ul>
<li>普通机制
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545212118571.png" alt=""></li>
<li>bypass机制
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545212666715.png" alt="">
<ul>
<li>bypass运行机制的触发条件如下:
shuffle reduce task 的 数 量 小 于
spark.shuffle.sort.bypassMergeThreshold 的参数值。这个
值默认是 200。</li>
<li>产生的磁盘小文件为:2*M(map task 的个数)</li>
</ul>
</li>
</ul>
<ol start="3">
<li>
<p>文件寻址
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545027799174.png" alt=""></p>
<ol>
<li>当maptask执行完成后，会将task的执行情况和磁盘小文件的 地址封装到 MpStatus 对象中，通过 MapOutputTrackerWorker 对象向 Driver 中的 MapOutputTrackerMaster 汇报。</li>
<li>在所有的maptask执行完毕后，Driver中就掌握了所有的磁盘 小文件的地址。</li>
<li>在reducetask执行之前，会通过Excutor中 MapOutPutTrackerWorker 向 Driver 端的 MapOutputTrackerMaster 获取磁盘小文件的地址。</li>
<li>获取到磁盘小文件的地址后，会通过BlockManager中的 ConnectionManager 连接数据所在节点上的
ConnectionManager,然后通过 BlockTransferService 进行数 据的传输。</li>
<li>BlockTransferService 默认启动 5 个 task 去节点拉取数据。默 认情况下，5 个 task 拉取数据量不能超过 48M。</li>
</ol>
</li>
<li>
<p>内存管理</p>
</li>
</ol>
<ul>
<li>静态内存管理  1.6之前
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545028681553.png" alt=""></li>
</ul>
<p>application-&gt;job-&gt;stage-&gt;task(pipline)</p>
<ul>
<li>统一内存管理  1.6之后
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545215215942.png" alt=""></li>
</ul>
<h3>分布式计算容易出现的问题</h3>
<ul>
<li>数据倾斜
<ul>
<li>groupbykey 大部分数据集中在某个key上</li>
</ul>
</li>
</ul>
<h2>Why ?</h2>
<ul>
<li>hadoop的共享数据慢 spark的共享数据快</li>
<li>快的原因：基于内存还有DAG</li>
<li>支持语言api
<ul>
<li>Scala</li>
<li>python</li>
<li>java</li>
</ul>
</li>
</ul>
<h2>Where?</h2>
<p>http://spark.apache.org</p>
<h2>How?</h2>
<ul>
<li>
<p>Spark代码流程</p>
<ul>
<li>创建SparkConf对象
<ul>
<li>可以设置 Application name。</li>
<li>可以设置运行模式及资源需求。</li>
</ul>
</li>
<li>创建SparkContext对象</li>
<li>基于Spark的上下文创建一个RDD，对RDD进行处理。
<ul>
<li>transformation转换 RDD &gt; RDD</li>
<li>缓存RDD，避免多次读取</li>
</ul>
</li>
<li>应用程序中要有Action类算子来触发Transformation类算子执行。
<ul>
<li>action执行 RDD &gt; 结果</li>
</ul>
</li>
<li>关闭Spark上下文对象SparkContext。</li>
</ul>
</li>
<li>
<p>选择缓存策略</p>
<ol>
<li>Cache() MEMORY_ONLY (默认)</li>
<li>MEMORY_AND_DISK</li>
<li>OFF_HEAP</li>
<li>DISK_ONLY</li>
<li>NONE</li>
</ol>
</li>
</ul>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">  SparkCon conf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"WordCound"</span>).setMaster(<span class="string">"local[*]"</span>);</span><br><span class="line">  JavaSparkContext sc = <span class="keyword">new</span> JavaSparkContext(conf);</span><br><span class="line">  JavaRdd(String) lines = sc.textFile(<span class="string">"CHANGES.txt"</span>);</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  JavaRDD&lt;String&gt; words = lines.flatMap(<span class="keyword">new</span> FlatMapFunction&lt;String,String&gt;()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title">call</span><span class="params">(String line)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Arrays.asList(line.split(<span class="string">" "</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  JavaPairRDD&lt;String, Integer&gt; pairs = words.mapToPair(<span class="keyword">new</span> PairFunction&lt;String,String,Integer&gt;()&#123;</span><br><span class="line">    <span class="meta">@Overridepublic</span> <span class="function">Tuple2&lt;String,Integer&gt; <span class="title">call</span><span class="params">(String word)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;String,Integer&gt;(word,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  JavaPairRDD&lt;Stirng, Integer&gt; results = pairs.reduceByKey(<span class="keyword">new</span> Function2&lt;Integer,Integer,Integer&gt;()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span> <span class="params">(Integer v1, Integer v2)</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> v1 + v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  results.sortByKey().results.foreach(<span class="keyword">new</span> VoidFunction&lt;Tuple2&lt;String,Integer&gt;&gt;()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">all</span><span class="params">(Tuple2&lt;Sting,Integer tuple)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">      System.out.println(tuple._1 + <span class="string">""</span> + tuple._2);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  sc.close;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3>任务调度</h3>
<ol>
<li>spark 提交应程序的机器</li>
<li>shell中 spark submit 脚本提交程序</li>
<li>启动一个driver 进程</li>
<li>spark submit  driver actor</li>
<li>spark context 对象</li>
<li>构造DAGschedule taskschedule</li>
<li>DAGscheduler</li>
<li>taskschedule task set 打散</li>
<li>taskschedule 向master注册application</li>
<li>master接到请求，启动多个exccutor</li>
<li></li>
<li>worker接受分配</li>
<li></li>
<li></li>
<li>DAGScheduler 切分job</li>
<li>stage taskset</li>
<li>taskschedule 把taskset中task提交到executer上执行</li>
<li></li>
</ol>
<p><img src="http://oapwg4v13.bkt.clouddn.com/1478337300.png" alt="">
<img src="http://oapwg4v13.bkt.clouddn.com/1478337459.png" alt="">
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/19/1545204757260.png" alt="">
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544883984019.png" alt=""></p>
<h3>local 单机模式</h3>
<p>本地直接运行调试</p>
<h2>安装完全分布式 standalone</h2>
<ol>
<li>
<p>下载
http://spark.apache.org/downloads.html
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544878999482.png" alt="">
<code>tar zxvf spark-1.6.3-bin-hadoop2.6.tgz</code></p>
</li>
<li>
<p>修改配置添加从节点
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd spark-1.6.3-bin-hadoop2.6</span><br><span class="line">cp slaves.template slaves</span><br><span class="line">vi slaves</span><br></pre></td></tr></table></figure></p>
<p>去掉localhost，添加从节点 名称
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544879233618.png" alt="">
<code>vi spark-env.sh</code>  下面这3个值更加自己情况修改
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SPARK_MASTER_IP=sj-node1</span><br><span class="line">SPARK_MASTER_PORT=7077</span><br><span class="line">SPARK_WORKER_MEMORY=1g</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>发送到从节点
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp -r spark-1.6.3-bin-hadoop2.6 root@sj-node2:`pwd`</span><br><span class="line">scp -r spark-1.6.3-bin-hadoop2.6 root@sj-node3:`pwd`</span><br><span class="line">`</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>启动集群
<code>/opt/soft/spark-1.6.0-bin-hadoop2.4/sbin/start-all.sh</code></p>
</li>
<li>
<p>打开Spark WEBUI 界面查看检查
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544879676963.png" alt="">
默认8080端口可能与别的应用冲突，可以修改<code>vim /opt/soft/spark-1.6.0-bin-hadoop2.4/sbin/start-master.sh</code>
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544879847739.png" alt="">
也可以修改环境变量</p>
</li>
<li>
<p>运行example 求 PI</p>
</li>
</ol>
<h4>standalone任务提交方式</h4>
<ol>
<li>client
<ol>
<li>client模式提交任务后，会在客户端启动Driver进程。</li>
<li>Driver会向Master申请启动Application启动的资源。</li>
<li>资源申请成功，Driver端将task发送到worker端执行。</li>
<li>worker将task执行结果返回到Driver端。</li>
</ol>
</li>
</ol>
<p><img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/14/1544798440810.png" alt="">
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./spark-submit</span><br><span class="line">--master spark://node1:7077 --deploy-mode client</span><br><span class="line">--class org.apache.spark.examples.SparkPi ../lib/spark-examples-1.6.0-hadoop2.6.0.jar 100</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>
<p>cluster</p>
<ol>
<li>cluster模式提交应用程序后，会向Master请求启动Driver.</li>
<li>Master接受请求，随机在集群一台节点启动Driver进程。</li>
<li>Driver启动后为当前的应用程序申请资源。</li>
<li>Driver端发送task到worker节点上执行。</li>
<li>worker将执行情况和执行结果返回给Driver端
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/14/1544798567313.png" alt=""></li>
</ol>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./spark-submit</span><br><span class="line">--master spark://node1:7077 --deploy-mode cluster</span><br><span class="line">--class org.apache.spark.examples.SparkPi ../lib/spark-examples-1.6.0-hadoop2.6.0.jar 100</span><br></pre></td></tr></table></figure></p>
</li>
</ol>
<h3>安装yarn运行模式</h3>
<p><code>vi /opt/soft/spark-1.6.0-bin-hadoop2.4/conf/spark-env.sh</code>
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544882112830.png" alt="">
添加hadoop的路径即可</p>
<h4>yarn任务提交方式</h4>
<ol>
<li>
<p>client</p>
<ol>
<li>客户端提交一个Application，在客户端启动一个Driver进程。</li>
<li>应用程序启动后会向RS(ResourceManager)发送请求，启动 AM(ApplicationMaster)的资源。</li>
<li>RS收到请求，随机选择一台NM(NodeManager)启动AM。这 里的 NM 相当于 Standalone 中的 Worker 节点。</li>
<li>AM启动后，会向RS请求一批container资源，用于启动Executor.</li>
<li>RS会找到一批NM返回给AM,用于启动Executor。</li>
<li>AM会向NM发送命令启动Executor。</li>
<li>Executor启动后，会反向注册给Driver，Driver发送task到 Executor,执行情况和结果返回给 Driver 端。
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/14/1544775013044.png" alt="">
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./spark-submit</span><br><span class="line">--master yarn–client</span><br><span class="line">--class</span><br><span class="line">org.apache.spark.examples.SparkPi ../lib/spark-examples-1.6.0-hadoop2.6.0.jar 100</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>
<p>cluster</p>
<ol>
<li>客户机提交Application应用程序，发送请求到
RS(ResourceManager),请求启动 AM(ApplicationMaster)。</li>
<li>RS收到请求后随机在一台NM(NodeManager)上启动AM(相
当于 Driver 端)。</li>
<li>AM启动，AM发送请求到RS，请求一批container用于启动
Excutor。</li>
<li>RS返回一批NM节点给AM。</li>
<li>AM连接到NM,发送请求到NM启动Excutor。</li>
<li>Excutor反向注册到AM所在的节点的Driver。Driver发送task 到 Excutor。
<img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/15/1544882432055.png" alt=""></li>
</ol>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./spark-submit</span><br><span class="line">--master yarn-cluster</span><br><span class="line">--class</span><br><span class="line">org.apache.spark.examples.SparkPi ../lib/spark-examples-1.6.0-hadoop2.6.0.jar 100</span><br><span class="line">`</span><br></pre></td></tr></table></figure></p>
</li>
</ol>
<h3>广播变量</h3>
<p><img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545013001423.png" alt="">
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val conf = <span class="keyword">new</span> SparkConf() conf.setMaster(<span class="string">"local"</span>).setAppName(<span class="string">"brocast"</span>)</span><br><span class="line">val sc = <span class="keyword">new</span> SparkContext(conf)</span><br><span class="line">val list = List(<span class="string">"hello xasxt"</span>)</span><br><span class="line">val broadCast = sc.broadcast(list)</span><br><span class="line">val lineRDD = sc.textFile(<span class="string">"./words.txt"</span>)</span><br><span class="line">lineRDD.filter &#123; x =&gt; broadCast.value.contains(x) &#125;.foreach &#123; println&#125; sc.stop()</span><br></pre></td></tr></table></figure></p>
<h3>累加器</h3>
<p><img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545013938695.png" alt="">
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val conf = <span class="keyword">new</span> SparkConf() conf.setMaster(<span class="string">"local"</span>).setAppName(<span class="string">"accumulator"</span>)</span><br><span class="line">val sc = <span class="keyword">new</span> SparkContext(conf)</span><br><span class="line">val accumulator = sc.accumulator(<span class="number">0</span>) sc.textFile(<span class="string">"./words.txt"</span>).foreach &#123; x =&gt;&#123;accumulator.add(<span class="number">1</span>)&#125;&#125; println(accumulator.value)</span><br><span class="line">sc.stop()</span><br></pre></td></tr></table></figure></p>
<h2>SparkUI</h2>
<ol>
<li>SparkUI界面介绍</li>
<li>配置historyServer
<ol>
<li>临时配置，对本次提交的应用程序起作用
<code>shell ./spark-shell --master spark://node1:7077 --name myapp1 --conf spark.eventLog.enabled=true --conf spark.eventLog.dir=hdfs://node1:9000/spark/test</code>
停止程序，在 Web Ui 中 Completed Applications 对应的 ApplicationID 中能查看 history</li>
<li>spark-default.conf配置文件中配置HistoryServer，对所有提交的 Application 都起作用
<ul>
<li>
<p><code>vi ../spark-1.6.0/conf/ spark-defaults.conf</code>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//开启记录事件日志的功能</span><br><span class="line">spark.eventLog.enabled true</span><br><span class="line">//设置事件日志存储的目录</span><br><span class="line">spark.eventLog.dir hdfs://node1:9000/spark/test</span><br><span class="line">//设置 HistoryServer 加载事件日志的位置</span><br><span class="line">spark.history.fs.logDirectory hdfs://node1:9000/spark/test</span><br><span class="line">//日志优化选项,压缩日志</span><br><span class="line">spark.eventLog.compress true</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>启动 HistoryServer:
<code>./start-history-server.sh</code>
访问 HistoryServer:node4:18080,之后所有提交的应用程序运行状况都会被记录。</p>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2>Master HA 高可用</h2>
<p><img src="http://wntc-1251220317.cossh.myqcloud.com/2018/12/17/1545053765403.png" alt="">
zookeeper 有选举和存储功能，可以存储 Master 的元素据信息，使用 zookeeper 搭建的 Master 高可用，当 Master 挂掉时，备用的 Master 会自动切换，推荐使用这种方式搭建 Master 的 HA。</p>
<ol>
<li>
<p>配置spark-env.sh，并发送到所有节点
<code>vim /opt/soft/spark-1.6.0-bin-hadoop2.4/conf/spark-env.sh</code>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export SPARK_DAEMON_JAVA_OPTS=" -Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=node3:2181,node4:2181,node5:2181 -Dspark.deploy.zookeeper.dir=/sparkmaster0821</span><br></pre></td></tr></table></figure></p>
</li>
<li>
<p>找一台节点(非主 Master 节点)配置备用 Master,修改 spark-env.sh 配置节点上的 MasterIP
<code>SPARK_MASTER_IP=sj-node2</code></p>
</li>
<li>
<p>启动zookeeper集群</p>
</li>
<li>
<p>启动spark集群  <code>sbin/start-all.sh</code></p>
</li>
<li>
<p>启动备用master  <code>sbin/start-daemon.sh</code></p>
</li>
</ol>
<blockquote>
<p>主备切换过程中不能提交 Application。主备切换过程中不影响已经在集群中运行的 Application。因为 Spark 是粗粒度资源调度。</p>
</blockquote>
<h3>优化</h3>
<ol>
<li>取top(N)  用手写排序，可以提高效率</li>
<li>资源调优
<ul>
<li>spark集群配置默认参数conf/spark-env.sh</li>
<li>提交application时分配资源</li>
<li>动态资源分配</li>
</ul>
</li>
<li>并行度调优
<ul>
<li>hdfs的block数据就是并行度，调低block大小相当于增加并行度，也可以读的时候指定</li>
<li>sc.parallelize(xxx, numPartitions)</li>
<li>sc.makeRDD(xxx, numPartitions)</li>
<li>sc.parallelizePairs(xxx, numPartitions)</li>
<li>repartions/coalesce</li>
<li>redecByKey/groupByKey/join ---(xxx, numPartitions)</li>
<li>spark.default.parallelism net set</li>
<li>spark.sql.shuffle.partitions---200</li>
<li>自定义分区器</li>
<li>如果读取数据是在SparkStreaming中
<ul>
<li>Receiver: spark.streaming.blockInterval—200ms</li>
<li>Direct:读取的 topic 的分区数</li>
</ul>
</li>
</ul>
</li>
<li>代码调优
<ol>
<li>避免创建重复rdd</li>
<li>复用同一个RDD</li>
<li>对多次使用的RDD进行持久化
<ul>
<li>cache</li>
<li>persist</li>
<li>checkpoint</li>
</ul>
</li>
<li>尽量避免使用shuffle类的算子
<ul>
<li>join 算子=广播变量+filter、广播变量+map、广播变量+flatMap</li>
</ul>
</li>
<li>map side 预聚合的shuffle操作
<ul>
<li>combine好处
<ul>
<li>降低 shuffle write 写磁盘的数据量。</li>
<li>降低 shuffle read 拉取数据量的大小</li>
<li>降低reduce端聚合的次数。</li>
</ul>
</li>
<li>有 combiner 的 shuffle 类算子
<ul>
<li>reduceByKey</li>
<li>aggregateByKey</li>
<li>combineByKey</li>
</ul>
</li>
</ul>
</li>
<li>尽量使用高性能的算子
<ul>
<li>使用 reduceByKey 替代 groupByKey
  - 使用 mapPartition 替代 map</li>
<li>使用 foreachPartition 替代 foreach
  - filter 后使用 coalesce 减少分区数</li>
<li>使用使用 repartitionAndSortWithinPartitions 替代 repartition 与 sort 类操作</li>
<li>使用 repartition 和 coalesce 算子操作分区</li>
</ul>
</li>
<li>使用广播变量</li>
<li>使用Kryo优化序列化性能</li>
<li>优化数据结构
<ul>
<li>尽量使用字符串替代对象，使用 原始类型(比如 Int、Long)替代字符串，使用数组替代集合类型</li>
</ul>
</li>
<li>使用高性能的库 fastutil</li>
</ol>
</li>
<li>数据本地化
<ul>
<li>级别
<ul>
<li>PROCESS_LOCAL</li>
<li>NODE_LOCAL</li>
<li>NO_PREF</li>
<li>RACK_LOCAL</li>
<li>ANY</li>
</ul>
</li>
<li>Spark数据本地化调优
<ul>
<li>spark.locality.wait</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2>参考</h2>
<p>http://spark.apache.org/docs/1.6.0/configuration.html</p>

      
    </div>

    
      


    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
  <img id="wechat_subscriber_qcode" src="http://wntc-1251220317.cossh.myqcloud.com/2019/3/8/1552054329801.png" alt="Juforg wechat" style="width: 200px; max-width: 100%;">
  <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>

      </div>
    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/大数据/" rel="tag"># 大数据</a>
          
            <a href="/tags/Spark/" rel="tag"># Spark</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
              <div>
                
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

              </div>
            
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ml/Scala实践/" rel="next" title="Scala入门">
                <i class="fa fa-chevron-left"></i> Scala入门
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/bigdata/hbase实践/" rel="prev" title="Hbases实践">
                Hbases实践 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Juforg">
            
              <p class="site-author-name" itemprop="name">Juforg</p>
              <p class="site-description motion-element" itemprop="description">以大多数人的努力程度之低还轮不到拼天赋</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">55</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">57</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/juforg" title="GitHub &rarr; https://github.com/juforg" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:juforg@sina.com" title="E-Mail &rarr; mailto:juforg@sina.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">1.</span> <span class="nav-text">What ?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.1.</span> <span class="nav-text">容错</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.2.</span> <span class="nav-text">依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.3.</span> <span class="nav-text">术语</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">1.3.1.</span> <span class="nav-text">算子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.4.</span> <span class="nav-text">shuffle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">1.5.</span> <span class="nav-text">分布式计算容易出现的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">2.</span> <span class="nav-text">Why ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">3.</span> <span class="nav-text">Where?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">4.</span> <span class="nav-text">How?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">4.1.</span> <span class="nav-text">任务调度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">4.2.</span> <span class="nav-text">local 单机模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">5.</span> <span class="nav-text">安装完全分布式 standalone</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">5.0.1.</span> <span class="nav-text">standalone任务提交方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">5.1.</span> <span class="nav-text">安装yarn运行模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">5.1.1.</span> <span class="nav-text">yarn任务提交方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">5.2.</span> <span class="nav-text">广播变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">5.3.</span> <span class="nav-text">累加器</span></a></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">6.</span> <span class="nav-text">SparkUI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">7.</span> <span class="nav-text">Master HA 高可用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#null"><span class="nav-number">7.1.</span> <span class="nav-text">优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#null"><span class="nav-number">8.</span> <span class="nav-text">参考</span></a></li></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">  <a href="http://www.miitbeian.gov.cn" rel="noopener" target="_blank">沪ICP备16050188号-1 </a>&copy; 2016 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-copyright"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Juforg</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.1</div>




  <script src="https://cdn.bootcdn.net/ajax/libs/mermaid/8.0.0/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>







  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1276674346&web_id=1276674346"></script>
  </div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script>

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script>

  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1/reading_progress.min.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>

  <script src="/js/src/kity.min.js?v=7.0.1"></script>

  <script src="/js/src/kityminder.core.min.js?v=7.0.1"></script>

  <script src="/js/src/mindmap.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.1"></script>


  
  
  

  

<script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script>



  

<script src="//cdnjs.cloudflare.com/ajax/libs/valine/1.3.4/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: 'LVc4wMV4nqOSxd3vboYEuxty-gzGzoHsz',
    appKey: 'AB11iu8RjTGwnLmI6D7THqDC',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false
  });
</script>




  


  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/src/algolia-search.js?v=7.0.1"></script>



  

  

  

  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
